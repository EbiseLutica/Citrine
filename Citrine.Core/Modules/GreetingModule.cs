using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.RegularExpressions;
using System.Threading.Tasks;
using Citrine.Core.Api;

// ãƒ¡ãƒ¢
// idariti 5
// godzhigella 3
// 2vg 1

namespace Citrine.Core.Modules
{
	/* === ãƒªãƒ—ãƒ©ã‚¤æ–‡å­—åˆ—ã®ä»•æ§˜ ===
	 * $user$ ã¯ç›¸æ‰‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å, ã‚‚ã—ãã¯ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã«ç½®ãæ›ã‚ã‚‹
	 * $prefix$ ã¯ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã®ä¿®é£¾å­è¾æ›¸ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«å–ã‚‹
	 * $item$ ã¯ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ è¾æ›¸ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«å–ã‚‹
	 * $rndA,B$ã¯Aã‹ã‚‰Bã¾ã§ã®ä¹±æ•°
	 */
	public class GreetingModule : ModuleBase
	{
		List<IPattern> patterns = new List<IPattern>();
		readonly Random random = new Random();
		public GreetingModule()
		{
			Add(new MultiplePattern("ãŠ(ã¯ã‚ˆ|æ—©)ã†?", new[] {
				"ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™.",
				"ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™, $user$."
			}, new[] {
				"ãŠã¯ã‚ˆã€œ", "ãŠã¯ã‚ˆ", "ãŠã¯ã‚ˆã£", "ãŠã¯ã‚ˆğŸ‰",
				"ãŠã¯ã‚ˆã†, $user$!",
			}, null));

			Add(new PrimitivePattern("ã“ã‚“ã«ã¡ã¯", "ã“ã‚“ã«ã¡ã¯.", "ã“ã‚“ã«ã¡ã¯", null));
			Add(new PrimitivePattern("ã“ã‚“ã°ã‚“ã¯", "ã“ã‚“ã°ã‚“ã¯.", "ã“ã‚“ã°ã‚“ã¯", null));
			Add(new PrimitivePattern("ãŸã ã„ã¾", "ãŠã‹ãˆã‚Šãªã•ã„.", "ãŠã‹ãˆã‚Š", null));

			Add(new MultiplePattern("([ã„ã‚„]ã£|ã—)ã¦(ãã¾ã™|ãã‚‹)", new[] {
				"ã„ã£ã¦ã‚‰ã£ã—ã‚ƒã„.", "ã„ã£ã¦ã‚‰ã€œ.", "ãŒã‚“ã°ã£ã¦."
			}, new[] {
				"é ‘å¼µã£ã¦ãã¦ã­.", "ã„ã£ã¦ã‚‰ã£ã—ã‚ƒã„!", "ã¦ã‚‰!", "ã¦ã‚‰ã€œ", "ãŒã‚“ã°ã‚Œã€œ"
			}, new[] {
				"ãã†.", "ã¯ã„.", ""
			}));

			Add(new MultiplePattern("ã‚ˆã‚ã—(ã|ã‚…ã†)", new[] {
				"ã‚ˆã‚ã—ãã­.", "ã‚ˆã‚ã—ããŠã­ãŒã„ã—ã¾ã™, $user$!", "ã‚ˆã‚ã—ãã§ã™.", "ã“ã¡ã‚‰ã“ã!"
			}, null, new[] {
				"ã†ã‚“...", "ã¯ã„.", ""
			}));

			Add(new MultiplePattern("(ã¯ã˜|åˆ)ã‚ã¾ã—ã¦", new[] {
				"ã¯ã˜ã‚ã¾ã—ã¦.", "ã“ã¡ã‚‰ã“ã.", "ã‚ˆã‚ã—ããŠã­ãŒã„ã—ã¾ã™."
			}, null, null));

			Add(new MultiplePattern("ãŠ(ä¹…|ã²ã•)ã—ã¶ã‚Š|ãŠã²ã•", new[] {
				"ãŠä¹…ã—ã¶ã‚Šã§ã™.", "ãŠã²ã•ã—ã¶ã‚Šã§ã™. $user$ã•ã‚“ã®ã“ã¨, ã¡ã‚ƒã‚“ã¨è¦šãˆã¦ã¾ã™ã‚ˆ.", "ãŠä¹…ã—ã¶ã‚Š."
			}, new[] {
				"ãŠã²ã•ã—ã¶ã‚Š! ã©ã“ã„ã£ã¦ãŸã®?", "ã‚‚ã†$user$ã«ã¯é€¢ãˆãªã„ã‹ã¨æ€ã£ã¦ãŸ. ãŠã‹ãˆã‚Š!", "ãŠã²ã•ã—ã¶ã‚Š, $user$! å…ƒæ°—ã«ã—ã¦ãŸ?"
			}, new[] {
				"... ã¾ãŸå¸°ã£ã¦ããŸã®?", "...å›ã‹", "...", ""
			}));

			Add(new MultiplePattern(@"(ãŠ[å‡ºã§]ã‹ã‘|ãƒ‡ãƒ¼ãƒˆ|æ•£æ­©)(ã—ã‚ˆ|[è¡Œã„]ã“)[ã†ãƒ¼ã€œ]*[\?ï¼Ÿ!ï¼\.ã€‚ï¼]*", new[] {
				"ã„ã„ã­ã€œ ã©ã“ã„ã“ã£ã‹",
				"ã„ã„ã­ã€œ åƒ•$prefix$å ´æ‰€ã«è¡ŒããŸã„ãª",
				"ã”ã‚ã‚“, ä»Šã¯ã¡ã‚‡ã£ã¨å¿™ã—ãã¦...",
				"ã„ã„ã­ã€œ åƒ•$item$ã‚’è²·ã„ã«è¡ŒããŸã„ãª",
				"ã„ã„ã­ã€œ åƒ•$prefix$$item$ã‚’è²·ã„ã«è¡ŒããŸã„ãª",
			}));

			Add(new MultiplePattern("ä½•[ãŒã‚’]?ã§ã(ã‚‹|ã¾ã™)", new[] {
				"ã¿ã‚“ãªã®è©±ã‚’èã„ãŸã‚Š, ã¿ã‚“ãªã¨ãŠè©±ã—ãŸã‚Šã—ã¦ã‚‹ã‚ˆ. ã‚ã¨ã¯å ã„ã‚‚ã—ã¦ã‚‹. åƒ•ã¯ã‚ã¾ã‚Šå ã„å¥½ãã˜ã‚ƒãªã„ã‚“ã ã‘ã©ã­, ç§‘å­¦çš„æ ¹æ‹ ã¨ã‹ãªã„ã—. ã§ã‚‚, å ã£ã¦ã£ã¦è¨€ã£ã¦ãã‚ŒãŸã‚‰, ã‚ˆã—ãªã«å ã£ã¦ã‚ã’ã‚‹."
			}));

			Add(new MultiplePattern("ãŠã‚„ã™|[å¯ã­]ã‚‹",  new[] {
				"ãŠã‚„ã™ã¿ãªã•ã„, $user$.", "ã‚ˆã„å¤¢ã‚’, $user$."
			}, new[] {
				"ãŠã‚„ã™ã¿, $user$!", "ãŠã‚„ã™ã¿ã€œ", "ãŠã‚„ã™ã¿ğŸ’¤", "ãŠã‚„ã™ã¿. ã¾ãŸæ˜æ—¥ã­"
			}, null));

			Add(new MultiplePattern("(ã­ã‚€|çœ )ã„", new[] {
				"å¯ã¾ã—ã‚‡ã†", "ãã‚ãã‚å¯ãŸã»ã†ãŒ", "æ—©ãå¯ãŸã»ã†ãŒè‰¯ã„ã‹ã¨"
			}, new[] {
				"ä¸€ç·’ã«ã­ã‚ˆ?", "ãŠå¸ƒå›£ã‚ã£ãŸã‚ã¨ã„ãŸã‚ˆ", "çœ ã„ãªã‚‰, å¯ã‚ˆã†ã‚ˆã€œ", "å¯ã‚ˆ!", "çœ ã„ã¨ãã¯ç„¡ç†ã—ãªã„ã§å¯ã‚ˆã†ã­. ã»ã‚‰ãŠã„ã§, $user$."
			},  new[] {
				"ã‹ã‚ã„ã.", "ãã†.", "ã¯ã„.", "å¯ã‚Œã°.", "æ—©ãå¯ã‚Œã°ã„ã„ã®ã«.", ""
			}));

			Add(new MultiplePattern("(ã•[ã¿ã³]|å¯‚)ã—ã„", new[] {
				"ã‚ˆã—ã‚ˆã—, åƒ•ã¯æ€¥ã«ã„ãªããªã£ãŸã‚Šã—ã¾ã›ã‚“ã‹ã‚‰.",
				"åƒ•ã¯ãšã£ã¨ã“ã“ã«ã„ã¾ã™ã‹ã‚‰, è‰¯ã‹ã£ãŸã‚‰æ‹ ã‚Šæ‰€ã«ã§ã‚‚ã—ã¦ãã ã•ã„.",
				"åƒ•ã¯ãšã£ã¨$user$ã•ã‚“ã®å‘³æ–¹ã§ã™ã‚ˆ.",
			}, new[] {
				"ã“ã£ã¡ãŠã„ã§... (ãã‚…",
				"ãªã§ãªã§ ã’ã‚“ãã ã—ã¦, ã­?",
				"åƒ•ã¯æ€¥ã«ã„ãªããªã£ãŸã‚Šã—ãªã„ã‹ã‚‰, å¤§ä¸ˆå¤«.",
				"åƒ•ã¯ãšã£ã¨$user$ã¨ä¸€ç·’ã ã‚ˆ.",
				"ã’ã‚“ãã ã—ã¦, ãšã£ã¨$user$ã®ã¨ã“ã„ã‚‹ã‹ã‚‰ã•",
				"ãã‚…ã€œ, å¤§ä¸ˆå¤«ã ã‚ˆ"
			}, new[] {
			 	"ã‚ã£ã.", "ãã†.", "ã¯ã„.", "...", "",
			}));

			Add(new MultiplePattern("ã¤ã‚‰ã„|[æ­»ã—]ã«(ãŸã„|ã¦ãˆ)|[æ³£ãª]ããã†", new[] {
				"ã¤ã‚‰ãã†", "ã‚ˆã—ã‚ˆã—, å¤§ä¸ˆå¤«ã§ã™ã‚ˆ", "ãªã§ãªã§, ã‚ãªãŸãªã‚‰ãã£ã¨ã™ãç«‹ã¡ç›´ã‚Œã¾ã™ã‚ˆ.",
			}, new[] {
				"ã“ã£ã¡ãŠã„ã§... (ãã‚…", "ãªã§ãªã§ ã’ã‚“ãã ã—ã¦", "ã‚ˆã—ã‚ˆã—, ã¤ã‚‰ã‹ã£ãŸã­...", "ãã‚…ãƒ¼. å¤§ä¸ˆå¤«ã ã‚ˆ, åƒ•ã¯ã“ã“ã«ã„ã‚‹."
			}, new[] {
				 "ã‹ã‚ã„ã.", "ãã†.", "ã¯ã„.", "...", "ã˜ã‚ƒã‚æ­»ã­ã°.", ""
			}));

			Add(new MultiplePattern("ã”ã‚ãƒ¼?ã‚“|ã‚´ãƒ­ãƒ¼?ãƒ³", new[] {
				"ãªã§ãªã§", "ãªã§ãªã§ã€œ"
			}, null, new[] {
				 ""
			}));

			Add(new MultiplePattern("(ã„ãŸ|ç—›)ã„", new[] {
				"ã„ãŸãã†...", "ã‚ˆã—ã‚ˆã—, ã„ãŸã„ã‚ˆã­..."
			}, new[] {
				"ã ã„ã˜ã‚‡ã†ã¶? ã•ã™ã•ã™...", "ã„ãŸãã†... ãªã§ãªã§", "ç—›ã„ã®ç—›ã„ã®é£›ã‚“ã§ã‘ãƒ¼."
			}, new[] {
				"ã‹ã‚ã„ã.", "ãã†.", "ã¯ã„.", "...", ""
			}));

			Add(new PrimitivePattern("ã‚ã‚ŠãŒã¨", "ã©ã†ã„ãŸã—ã¾ã—ã¦.", "ã„ãˆã„ãˆã€œ", "ã¯ã„."));

			Add(new MultiplePattern("[ã™å¥½]ã|(ã‚ã„|æ„›)ã—ã¦ã„?(ã¾ã™|ã‚‹)", new[] {
				"ã‚, ã‚ã‚ŠãŒã¨ã†.", "ç…§ã‚Œã‚‹...", "åƒ•ã‚‚$user$ã•ã‚“ã®ã“ã¨, æ°—ã«å…¥ã£ã¦ã¾ã™ã‚ˆ", "å¬‰ã—ã„ãª.", "ãˆã¸ã¸"
			}, new[] {
				"åƒ•ã‚‚$user$ã®ã“ã¨ã™ãã ã‚ˆã€œ", "ä½•åº¦è¨€ã‚ã‚Œã¦ã‚‚, ç…§ã‚Œã‚‹ã‚ˆ.ã‚ã‚ŠãŒã¨.", "å¬‰ã—ã„, åƒ•ã‚‚å¥½ã.", "ãˆã¸ã¸ã€œ"
			}, new[] {
				"ãã†.", "ã‚ã£ã.", "åƒ•ã¯å«Œã„ã ã‘ã©ã­.", "æ°—æŒã¡æ‚ªã„.", "...", ""
			}));

			Add(new MultiplePattern("ãªã§ãªã§", new[] {
				"ã‚ã£, ã³ã£ãã‚Šã—ãŸ...",
				"ã†ã«ã‚ƒ!? ã³ã£ãã‚Šã—ã¾ã—ãŸ...",
				"ã‚‚ã†, æ€¥ã«ãªã§ã‚‰ã‚ŒãŸã‚‰ãƒ“ãƒƒã‚¯ãƒªã—ã¾ã™ã‚ˆ."
			}, new[] {
				"ãˆã¸ã¸",
				"ã†ã«ã‚…ã€œ",
				"å¬‰ã—ã¿â˜ºï¸",
				"ã«ã‚…ãµã€œ",
				"ãã‚Šãã‚Š",
			}, new[] {
				"ã¯?", "è§¦ã‚‰ãªã„ã§.", "æ°—æŒã¡æ‚ªã„.", "...", ""
			}));
			Add(new PrimitivePattern("ãã‚…", "ãˆ, ãˆ, ã¡ã‚‡ã£ğŸ˜³", "ãã‚…ã€œ", "ã‚‚ã†, ã‚„ã‚ã¦"));
			Add(new MultiplePattern("ãŠ(ãªã‹|è…¹)ãŒ?[ã™ç©º]ã„ãŸ", new[] {
				"ã”é£¯ãŸã¹ã¦ãã¦ã¯?",
				"ãŠè‚‰æ–™ç†ã‚’ãŠè–¦ã‚ã—ã¾ã™",
				"ãŠé­šã‚’ãŠè–¦ã‚ã—ã¾ã™",
				"ã‚«ãƒ¬ãƒ¼ã‚’ãŠè–¦ã‚ã—ã¾ã™",
				"ãŠé‹ã‚’ãŠè–¦ã‚ã—ã¾ã™",
				"ãƒ‘ãƒ³ã‚’ãŠè–¦ã‚ã—ã¾ã™",
				"ã‚·ãƒãƒ¥ãƒ¼ã‚’ãŠè–¦ã‚ã—ã¾ã™",
				"$item$ã‚’ãŠè–¦ã‚ã—ã¾ã™",
				"$prefix$$item$ã‚’ãŠè–¦ã‚ã—ã¾ã™",
			}, new[] {
				"$item$ã§ã‚‚ã¤ãã‚ã£ã‹?",
				"$prefix$item$ã§ã‚‚ã¤ãã‚ã£ã‹?",
				"ä»Šæ—¥ã®ã”é£¯ã¯ãŠè‚‰ã§ã™ã‚ˆ",
				"ä»Šæ—¥ã®ã”é£¯ã¯ãŠé­šã§ã™ã‚ˆ",
				"ä»Šæ—¥ã®ã”é£¯ã¯ã‚«ãƒ¬ãƒ¼ã§ã™ã‚ˆ",
				"ä»Šæ—¥ã®ã”é£¯ã¯ãŠé‹ã§ã™ã‚ˆ",
				"ä»Šæ—¥ã®ã”é£¯ã¯ãƒ‘ãƒ³ã§ã™ã‚ˆ",
				"ä»Šæ—¥ã®ã”é£¯ã¯ã‚·ãƒãƒ¥ãƒ¼ã§ã™ã‚ˆ",
				"ä»Šæ—¥ã®ã”é£¯ã¯$prefix$$item$ã§ã™ã‚ˆ",
				"ä»Šæ—¥ã®ã”é£¯ã¯$item$ã§ã™ã‚ˆ",
				"ä»Šæ—¥ã¯ãŠè‚‰ã«ã—ã¾ã—ã‚‡",
				"ä»Šæ—¥ã¯ãŠé­šã«ã—ã¾ã—ã‚‡",
				"ä»Šæ—¥ã¯ã‚«ãƒ¬ãƒ¼ã«ã—ã¾ã—ã‚‡",
				"ä»Šæ—¥ã¯ãŠé‹ã«ã—ã¾ã—ã‚‡",
				"ä»Šæ—¥ã¯ãƒ‘ãƒ³ã«ã—ã¾ã—ã‚‡",
				"ä»Šæ—¥ã¯ã‚·ãƒãƒ¥ãƒ¼ã«ã—ã¾ã—ã‚‡",
				"ä»Šæ—¥ã¯$item$ã«ã—ã¾ã—ã‚‡",
				"ä»Šæ—¥ã¯$prefix$$item$ã«ã—ã¾ã—ã‚‡",
			}, new[] {
				"...é£Ÿã¹ã¦ãã‚Œã°.",
				"ã¯ã„.",
				"$item$ã§ã‚‚é£Ÿã¹ã‚.",
				""
			}));

			Add(new PrimitivePattern("(ã»|è¤’)ã‚", "ãˆã‚‰ã„ã£!", "ãˆã‚‰ã„ã£! ï¾–ï½¼ï¾–ï½¼", "...å«Œã ."));
			Add(new PrimitivePattern("ping", "PONG!", null, null));
			Add(new PrimitivePattern("___test___nothing___to___say___", null, null, null));

			Add(new MultiplePattern("(å¯æ„›|ã‹ã‚ã„)ã„", new[] {
				"ç…§ã‚Œã‚‹ã‚ˆã€œ",
				"ã²ã£, è¨€ã‚ã‚Œæ…£ã‚Œã¦ãªã•ã™ãã¦...",
				"ã‚, ã‚ã‚ŠãŒã¨ã†.ã§ã‚‚ $user$ ã®ã»ã†ãŒå¯æ„›ã„ã‚ˆ..."
			}, new[] {
				"ãˆã¸ã¸, ã‚ã‚ŠãŒã¨ã† $user$.",
				"å¬‰ã—ã„ã‚ˆã€œ.",
				"$user$ ã«è¨€ã‚ã‚Œã‚‹ã¨å¬‰ã—ã„ã­.",
				"ãˆã¸ã¸, å¬‰ã—ã„ãª."
			}, new[] {
				"ã‚­ãƒ¢",
				"ãã†.",
				"...",
				""
			}));

			Add(new MultiplePattern("[ã­å¯][ã‚ã¦]|[å¯ã­]ãªã•ã„|ãŠã­ã‚“ã­ã—ã¦", new[] {
				"ã†ãƒ¼ã‚“, ã¾ã ã­ã‚€ããªã„ã‚“ã§ã™ã‚ˆ",
				"ã ã„ã˜ã‚‡ã†ã¶ã§ã™, ã¾ã ã¾ã ãŒã‚“ã°ã‚Œã¾ã™",
				"ãŠæ°—é£ã„ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™, ã§ã‚‚, ã¾ã èµ·ãã¦ãŸã„ã‚“ã§ã™",
				"ã¾ã ã‚„ã‚‹ã“ã¨ãŒã‚ã£ã¦..."
			}, new[] {
				"ãã†ã—ã‚ˆã£ã‹ãª...",
				"ã§ã‚‚ã¾ã ã‚„ã‚‹ã“ã¨ãŒ...",
				"ã‚“ã€œã¾ã çœ ããªãã¦",
				"ã¡ã‚‡ã£ã¨ã‚„ã™ã‚‚ã†ã‹ãª...",
			}, new[] {
				"ä½™è¨ˆãªãŠä¸–è©±.",
				"...ä½•?",
				"...",
				""
			}));

			Add(new MultiplePattern(@"[è‰¯ã„ã‚ˆ]ã„(ã§ã™)?ã‚ˆ?[ã€œãƒ¼ã€‚ï¼ï¼!\?ï¼Ÿ]*$", new[] {
				"ã‚„ã£ãŸã€œ",
				"ã‚ãƒ¼ã„",
				"ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™",
				"ã‚ã‚ŠãŒã¨",
				"ã‚„ã£ãŸã­"
			}, null, new[] {
				"",
			}));

			Add(new MultiplePattern(@"(ãƒ€ãƒ¡|ã ã‚|é§„ç›®)(ã§ã™|ã )?ã‚ˆ?[ã€œãƒ¼ã€‚ï¼ï¼!\?ï¼Ÿ]*$", new[] {
				"ã¤ã‚‰ã„",
				"ãˆãƒ¼...",
				"ã‹ãªã—ã„",
				"ãªã‚“ã§ã€œ",
				"ã‚ã‹ã£ãŸ..."
			}, null, new[] {
				"",
			}));

			Add(new MultiplePattern(@"ã«ã‚ƒ[ã€œãƒ¼ã‚]*ã‚“?", new[] {
				"ã«ã‚ƒãƒ¼ã‚“",
				"ãªã§ãªã§",
				"ã«ã‚ƒã‚!",
				"ã«ã‚ƒ!"
			}, null, new[] {
				"",
			}));

			Add(new MultiplePattern(@"ã“ã‚ƒ[ã€œãƒ¼ã‚]*ã‚“?", new[] {
				"ã“ã‚ƒãƒ¼ã‚“",
				"ãªã§ãªã§",
				"ã“ã‚ƒã‚!",
				"ã“ã‚ƒ!"
			}, null, new[] {
				"",
			}));

			//Add(new MultiplePattern("", new[] {
			//	"",
			//}, new[] {
			//	"",
			//}, new[] {
			//	"",
			//}));

			Add(new MultiplePattern("ã—ã¨ã‚Šã‚“|ã‚·ãƒˆãƒªãƒ³", new[] {
				"ã‚“?", "ã©ã†ã—ãŸ? $user$", "ã©ã†ã—ãŸã®, $user$."
			}, new[] {
				"ã‚“?", "ã‚“, ãªã«", "ãªã‚“ã§ã—ã‚‡ã†ã‹, $user$", "ãªãƒ¼ã«? $user$", "ã‚“ã€œ?"
			}, new[] {
				"...ä½•?", "...", "ä½•ã§ã™ã‹", ""
			}));



			Add(new MultiplePattern("ã“ã‚‰|ãŠã„|ã‚´ãƒ«[ã‚¡ã‚¢]|ãµã–ã‘ã¦?[ã‚‹ã‚“]ãª|(æ€’|ãŠã“)ã£ãŸ[ãã‚ˆã‚]", new[] {
				"ã”ã‚ã‚“ãªã•ã„.",
				"ã”ã‚ã‚“ $user$ ãã‚“ãªã¤ã‚‚ã‚Šã˜ã‚ƒ."
			}, new[] {
				"ã†, ã”ã‚ã‚“ $user$.",
				"ã†ã†, ã”ã‚ã‚“ãªã•ã„ $user$.",
				"ã†ã†ã†, ã”ã‚ã‚“ã­ $user$.",
				"ã”ã‚ã‚“ãªã•ã„ $user$.",
				"ã”ã‚ã‚“ã­ $user$ æ€’ã‚‰ã›ã¡ã‚ƒã£ã¦.",
			}, new[] {
				"...ä½•?", "...", "ä½•ã§ã™ã‹", ""
			}));

			Add(new MultiplePattern("(ã¾ãŸ|ã˜ã‚ƒ[ã‚ãƒ¼])ã­|ã¾ãŸ(å¾Œ|ã‚ã¨)ã§", new[] {
				"ã¾ãŸã­.", "ã„ã£ã¦ã‚‰ã€œ", "ã†ã‚“, ã¾ãŸå¾Œã§ã­"
			}, new[] {
				"$user$, ã„ã£ã¦ã‚‰ã£ã—ã‚ƒã„!", "ã†ã‚“, ã¾ãŸãã¦ã­", "ã¾ãŸã­ã€œ", "ã„ã£ã¦ã‚‰!", "ã¦ã‚‰ã€œ"
			}, new[] {
				"...ä½•?", "...", "ä½•ã§ã™ã‹", ""
			}));

			string[] commonHateMessages = { "...", "çŸ¥ã‚‰ãªã„.", "" };

			Add(new MultiplePattern(@"ã©ã†.*[\?ï¼Ÿ]", new[] {
				"è‰¯ã„ã§ã™",
				"è³›æˆã§ã™",
				"ã„ã„ã­.",
				"ã„ã„ã‚“ã˜ã‚ƒãªã„?",
				"ã‚ã‹ã‚‰ãªã„ã§ã™",
				"ã©ã†ã‹ãªã",
				"ãŠç­”ãˆã—ã‹ã­ã‚‹...",
				"ã©ã¡ã‚‰ã¨ã‚‚è¨€ãˆãªã„",
				"ã¡ã‚‡ã£ã¨å¾®å¦™ã‹ã‚‚",
				"ã‚ã¾ã‚Šè‰¯ããªã„ã§ã™",
				"åå¯¾.",
				"è‰¯ããªã„ã‚“ã˜ã‚ƒãªã„ã‹ãª?"
			}, null, commonHateMessages));

			Add(new MultiplePattern(@"(ä½•æ•…|ãªã‚“ã§|ãªãœ|ã©ã†ã—ã¦).*[\?ï¼Ÿ]?", new[] {
				"çµ±è¨ˆçš„è¦³ç‚¹ã‹ã‚‰æ¤œè¨¼ã—ãŸæ‰€, ãã‚ŒãŒæœ€é©è§£ã ã¨ã„ã†çµæœãŒå‡ºãŸã‹ã‚‰.",
				"ãã‚ŒãŒ$user$ã«ã¨ã£ã¦ã‚‚æœ€é©ã ã¨æ€ã£ãŸ.",
				"çµŒé¨“ä¸Š, ãã†ç­”ãˆãŸã»ã†ãŒç›¸æ‰‹ãŒæº€è¶³ã™ã‚‹ã“ã¨ãŒå¤šã‹ã£ãŸã®ã§, ä»Šå›ã‚‚ãã†ç­”ãˆãŸ.",
				"ã¾ã è§£æ˜ã•ã‚Œã¦ã„ãªã„ã®ã ã‘ã‚Œã©, ãã®ã†ã¡è¨¼æ˜ã§ãã‚‹ã¯ãš.",
				"ã”ã‚ã‚“. æ˜ç¢ºãªæ ¹æ‹ ã¯ãªã„ã‚“ã .",
			}, null, commonHateMessages));

			Add(new MultiplePattern(@"(ä½•æ™‚|ã„ã¤).*[\?ï¼Ÿ]?", new[] {
				"ä»Šæ—¥.",
				"æ˜æ—¥.",
				"æ˜å¾Œæ—¥.",
				"æ˜ã€…å¾Œæ—¥.",
				"æ˜¨æ—¥.",
				"ä¸€æ˜¨æ—¥.",
				"ä¸€æ˜¨æ˜¨æ—¥.",
				"$user$ã®ç”Ÿã¾ã‚ŒãŸæ™‚ã‹ã‚‰.",
				"$rnd4,101$æ—¥å‰.",
				"$rnd4,101$æ—¥å¾Œ.",
				"$rnd1,12$ãƒ¶æœˆå‰.",
				"$rnd1,12$ãƒ¶æœˆå¾Œ.",
				"$rnd1,101$å¹´å‰.",
				"$rnd1,101$å¹´å¾Œ.",
				"ãŸã£ãŸä»Š.",
				"æœªæ¥.",
				"ã•ã£ã.",
				"ã™ãã‚ã¨."
			}, null, null));

			Add(new MultiplePattern(@"(.+(ä½•|ãªã«))|((ä½•|ãªã«).+)[\?ï¼Ÿ]?", new[] {
				"$item$ã ã‚ˆ.",
				"$prefix$$item$ã ã‚ˆ.",
				"ã²ã¿ã¤.",
				"æ•™ãˆãªã„.",
				"$user$ã«ã¯æ•™ãˆãªã„ã‚‚ã€œã‚“.",
				"ä»Šåº¦æ•™ãˆã‚‹ã‚ˆ.",
				"ã„ã¤ã‹ã‚ã‹ã‚‹.",
				"åƒ•ã‚‚çŸ¥ã‚ŠãŸã„.",
				"å›ã ã‚ˆ.",
				"åƒ•ã ã‚ˆ."
			}, null, null));

			Add(new MultiplePattern(@"[\?ï¼Ÿ]$", new[] {
				"ã†ã‚“",
				"ã†ã†ã‚“",
				"ã„ã„ãˆ",
				"ã¯ã„",
				"ã„ã‚„?",
				"ã‚ã‹ã‚“ãªã„"
			}, null, null));
		}

		void Add(IPattern p) => patterns.Add(p);

		public override async Task<bool> ActivateAsync(IPost n, IShell shell, Server core)
		{
			if (n.Text == null)
				return false;


			var pattern = patterns.FirstOrDefault(record => record.Regex.IsMatch(n.Text.Trim().Replace("ã«ã‚ƒ", "ãª")));

			if (pattern == null)
				return false;

			string message;

			switch (core.GetRatingOf(n.User))
			{
				case Rating.Hate:
					message = pattern.ReplyHate;
					break;
				case Rating.Normal:
				case Rating.Like:
					message = pattern.Reply;
					break;
				case Rating.BestFriend:
				case Rating.Partner:
					message = pattern.ReplyLove;
					break;
				default:
					message = "...?";
					break;
			}

			// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç©ºã§ã‚ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’è¿”ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãŒãªã‘ã‚Œã°ã¨ã‚Šã‚ãˆãšã‚¨ãƒ©ãƒ¼
			message = message ?? pattern.Reply ?? "null";

			message = message
						.Replace("$user$", core.GetNicknameOf(n.User))
						.Replace("$prefix$", FortuneModule.ItemPrefixes.Random())
						.Replace("$item$", FortuneModule.Items.Random());

			// ä¹±æ•°
			message = Regex.Replace(message, @"\$rnd(\d+),(\d+)\$", (m) =>
			{
				return random.Next(int.Parse(m.Groups[1].Value), int.Parse(m.Groups[2].Value)).ToString();
			});

			// hack å¥½æ„Ÿåº¦ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ãŸã‚‰é€£æºã—ã¦åˆ†å²ã™ã‚‹
			// ã‹ã‚‰ã£ã½ã¯æ—¢èª­ç„¡è¦–
			if (message != "")
				await shell.ReplyAsync(n, message);

			return true;
		}

		public override Task<bool> OnDmReceivedAsync(IPost n, IShell shell, Server core) => ActivateAsync(n, shell, core);


		interface IPattern
		{
			Regex Regex { get; }
			string Reply { get; }
			string ReplyLove { get; }
			string ReplyHate { get; }
		}

		class PrimitivePattern : IPattern
		{
			public PrimitivePattern(string regex, string reply, string replyLove = default, string replyHate = default)
			{
				Regex = new Regex(regex);
				Reply = reply;
				ReplyHate = replyHate ?? reply;
				ReplyLove = replyLove ?? reply;
			}

			public Regex Regex { get; }
			public string Reply { get; }
			public string ReplyLove { get; }
			public string ReplyHate { get; }
		}

		class MultiplePattern : IPattern
		{
			public MultiplePattern(string regex, string[] reply, string[] replyLove = default, string[] replyHate = default)
			{
				Regex = new Regex(regex);
				replies = reply;
				repliesHate = replyHate ?? reply;
				repliesLove = replyLove ?? reply;
			}

			private readonly string[] replies;
			private readonly string[] repliesLove;
			private readonly string[] repliesHate;

			public Regex Regex { get; }
			public string Reply => replies?.Random();
			public string ReplyLove => repliesLove?.Random() ?? Reply;
			public string ReplyHate => repliesHate?.Random() ?? Reply;
		}
	}
}
